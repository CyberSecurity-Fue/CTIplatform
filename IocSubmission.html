<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/jpg" href="../image.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IOC Submission | CTI-Blockchain | Submit Threat Indicators</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=Source+Code+Pro:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2A6FFF;
            --secondary: #00D4AA;
            --accent: #FF6B6B;
            --dark: #0A0F1C;
            --darker: #050811;
            --light: #F8FAFC;
            --gray: #64748B;
            --gold: #FFD166;
            --purple: #9D4EDD;
            --neon-blue: #00F5FF;
            --neon-green: #39FF14;
            --transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Source Code Pro', monospace;
            line-height: 1.6;
            color: var(--light);
            background: var(--dark);
            overflow-x: hidden;
            position: relative;
        }

        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            opacity: 0.03;
        }

        .grid-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(42, 111, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(42, 111, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: -1;
            opacity: 0.2;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header & Navigation */
        header {
            background: rgba(10, 15, 28, 0.9);
            backdrop-filter: blur(10px);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(42, 111, 255, 0.2);
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.2rem 0;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--light);
            font-family: 'Montserrat', sans-serif;
        }

        .logo i {
            color: var(--primary);
            margin-right: 0.5rem;
            text-shadow: 0 0 10px var(--primary);
            animation: pulse 2s infinite;
        }

        .nav-links {
            display: flex;
            list-style: none;
        }

        .nav-links li {
            margin-left: 2rem;
            position: relative;
        }

        .nav-links a {
            color: var(--light);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            position: relative;
            font-size: 0.9rem;
            letter-spacing: 0.5px;
        }

        .nav-links a:after {
            content: '';
            position: absolute;
            width: 0;
            height: 1px;
            bottom: -5px;
            left: 0;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: var(--transition);
        }

        .nav-links a:hover {
            color: var(--neon-blue);
        }

        .nav-links a:hover:after {
            width: 100%;
            box-shadow: 0 0 8px var(--primary);
        }

        .auth-buttons {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.7rem 1.5rem;
            border-radius: 4px;
            font-weight: 600;
            text-decoration: none;
            transition: var(--transition);
            display: inline-block;
            font-size: 0.9rem;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }

        .btn-outline {
            border: 1px solid var(--primary);
            color: var(--primary);
            background: transparent;
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
            box-shadow: 0 0 15px rgba(42, 111, 255, 0.5);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            border: 1px solid var(--primary);
        }

        .btn-primary:hover {
            background: transparent;
            color: var(--primary);
            box-shadow: 0 0 15px rgba(42, 111, 255, 0.5);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn:disabled:hover {
            background: var(--primary);
            color: white;
            box-shadow: none;
        }

        .btn-warning {
            background: var(--gold);
            color: var(--dark);
            border: 1px solid var(--gold);
        }

        .btn-warning:hover {
            background: transparent;
            color: var(--gold);
            box-shadow: 0 0 15px rgba(255, 209, 102, 0.5);
        }

        /* Platform Layout */
        .platform-layout {
            display: flex;
            min-height: 100vh;
            padding-top: 80px;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background: rgba(10, 15, 28, 0.9);
            border-right: 1px solid rgba(42, 111, 255, 0.2);
            padding: 2rem 1rem;
            position: fixed;
            height: calc(100vh - 80px);
            overflow-y: auto;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 0.5rem;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 0.8rem 1rem;
            color: var(--gray);
            text-decoration: none;
            border-radius: 6px;
            transition: var(--transition);
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background: rgba(42, 111, 255, 0.1);
            color: var(--primary);
            border-left: 3px solid var(--primary);
        }

        .sidebar-menu i {
            margin-right: 0.8rem;
            width: 20px;
            text-align: center;
        }

        .sidebar-section {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-section h3 {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 2rem;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .page-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            color: var(--light);
        }

        .page-actions {
            display: flex;
            gap: 1rem;
        }

        /* Submission Layout */
        .submission-layout {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 2rem;
        }

        /* Submission Form */
        .submission-form {
            background: rgba(10, 15, 28, 0.7);
            border-radius: 10px;
            padding: 2rem;
            border: 1px solid rgba(42, 111, 255, 0.2);
        }

        .form-header {
            margin-bottom: 2rem;
        }

        .form-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--light);
            margin-bottom: 0.5rem;
        }

        .form-subtitle {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--light);
            font-weight: 500;
        }

        .form-label .required {
            color: var(--accent);
        }

        .form-control {
            width: 100%;
            padding: 0.8rem 1rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(42, 111, 255, 0.3);
            border-radius: 4px;
            color: var(--light);
            font-family: 'Source Code Pro', monospace;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(42, 111, 255, 0.3);
        }

        .form-control.error {
            border-color: var(--accent);
            box-shadow: 0 0 10px rgba(255, 107, 107, 0.3);
        }

        .form-hint {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 0.3rem;
        }

        .form-error {
            font-size: 0.8rem;
            color: var(--accent);
            margin-top: 0.3rem;
            display: none;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .checkbox {
            width: 18px;
            height: 18px;
            margin-right: 0.5rem;
            accent-color: var(--primary);
        }

        .checkbox-label {
            color: var(--light);
            font-size: 0.9rem;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* AI Analysis Section */
        .ai-analysis {
            background: rgba(10, 15, 28, 0.7);
            border-radius: 10px;
            padding: 2rem;
            border: 1px solid rgba(157, 78, 221, 0.3);
            margin-top: 2rem;
            display: none;
        }

        .ai-analysis-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .ai-analysis-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: rgba(157, 78, 221, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            color: var(--purple);
        }

        .ai-analysis-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--light);
        }

        .analysis-tabs {
            display: flex;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .analysis-tab {
            padding: 0.8rem 1.5rem;
            background: transparent;
            border: none;
            color: var(--gray);
            font-family: 'Source Code Pro', monospace;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            white-space: nowrap;
        }

        .analysis-tab.active {
            color: var(--purple);
        }

        .analysis-tab.active:after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--purple);
            border-radius: 3px 3px 0 0;
        }

        .analysis-tab:hover:not(.active) {
            color: var(--light);
        }

        .analysis-content {
            display: none;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .analysis-content.active {
            display: block;
            animation: slideIn 0.5s ease-out;
        }

        .analysis-section {
            margin-bottom: 1.5rem;
        }

        .analysis-section:last-child {
            margin-bottom: 0;
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-icon {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            background: rgba(42, 111, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            color: var(--primary);
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--light);
        }

        .section-content {
            color: var(--light);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .section-content p {
            margin-bottom: 0.8rem;
        }

        .section-content ul, .section-content ol {
            margin-left: 1.5rem;
            margin-bottom: 0.8rem;
        }

        .section-content li {
            margin-bottom: 0.5rem;
        }

        .risk-badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.8rem;
            margin-left: 0.5rem;
        }

        .risk-low {
            background: rgba(0, 212, 170, 0.2);
            color: var(--secondary);
            border: 1px solid var(--secondary);
        }

        .risk-medium {
            background: rgba(255, 209, 102, 0.2);
            color: var(--gold);
            border: 1px solid var(--gold);
        }

        .risk-high {
            background: rgba(255, 107, 107, 0.2);
            color: var(--accent);
            border: 1px solid var(--accent);
        }

        .risk-critical {
            background: rgba(157, 78, 221, 0.2);
            color: var(--purple);
            border: 1px solid var(--purple);
            animation: pulse 2s infinite;
        }

        .analysis-loading {
            text-align: center;
            padding: 3rem;
        }

        .analysis-error {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            color: var(--accent);
        }

        .copy-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(42, 111, 255, 0.2);
            color: var(--primary);
            border: 1px solid rgba(42, 111, 255, 0.3);
            border-radius: 4px;
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .copy-btn:hover {
            background: var(--primary);
            color: white;
        }

        .analysis-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Submission Sidebar */
        .submission-sidebar {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        /* Submission Guide */
        .submission-guide {
            background: rgba(10, 15, 28, 0.7);
            border-radius: 10px;
            padding: 1.5rem;
            border: 1px solid rgba(42, 111, 255, 0.2);
        }

        .guide-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .guide-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: rgba(42, 111, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            color: var(--primary);
        }

        .guide-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--light);
        }

        .guide-list {
            list-style: none;
        }

        .guide-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .guide-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .guide-bullet {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: rgba(0, 212, 170, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            flex-shrink: 0;
            color: var(--secondary);
            font-size: 0.7rem;
            font-weight: 600;
        }

        .guide-content h4 {
            font-size: 0.9rem;
            margin-bottom: 0.3rem;
            color: var(--light);
        }

        .guide-content p {
            font-size: 0.8rem;
            color: var(--gray);
            line-height: 1.5;
        }

        /* Blockchain Preview */
        .blockchain-preview {
            background: rgba(10, 15, 28, 0.7);
            border-radius: 10px;
            padding: 1.5rem;
            border: 1px solid rgba(42, 111, 255, 0.2);
        }

        .preview-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .preview-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: rgba(0, 212, 170, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            color: var(--secondary);
        }

        .preview-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--light);
        }

        .preview-content {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            padding: 1rem;
            border: 1px solid rgba(0, 212, 170, 0.2);
            font-family: 'Source Code Pro', monospace;
            font-size: 0.8rem;
            line-height: 1.5;
            color: var(--neon-green);
            max-height: 200px;
            overflow-y: auto;
        }

        .preview-line {
            margin-bottom: 0.3rem;
        }

        .preview-key {
            color: var(--primary);
        }

        /* Submission Status */
        .submission-status {
            background: rgba(10, 15, 28, 0.7);
            border-radius: 10px;
            padding: 1.5rem;
            border: 1px solid rgba(42, 111, 255, 0.2);
            display: none;
        }

        .status-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .status-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: rgba(0, 212, 170, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            color: var(--secondary);
        }

        .status-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--light);
        }

        .status-timeline {
            position: relative;
            padding-left: 2rem;
        }

        .status-step {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
            position: relative;
        }

        .status-step:last-child {
            margin-bottom: 0;
        }

        .status-step:before {
            content: '';
            position: absolute;
            left: -2rem;
            top: 0;
            bottom: -1.5rem;
            width: 2px;
            background: rgba(255, 255, 255, 0.1);
        }

        .status-step:last-child:before {
            display: none;
        }

        .status-bullet {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            margin-right: 1rem;
            position: relative;
            z-index: 1;
        }

        .status-bullet.completed {
            background: var(--secondary);
            box-shadow: 0 0 10px var(--secondary);
        }

        .status-bullet.active {
            background: var(--primary);
            box-shadow: 0 0 10px var(--primary);
            animation: pulse 1.5s infinite;
        }

        .status-info h4 {
            font-size: 0.9rem;
            margin-bottom: 0.2rem;
            color: var(--light);
        }

        .status-info p {
            font-size: 0.8rem;
            color: var(--gray);
        }

        /* Recent Submissions */
        .recent-submissions {
            background: rgba(10, 15, 28, 0.7);
            border-radius: 10px;
            padding: 1.5rem;
            border: 1px solid rgba(42, 111, 255, 0.2);
        }

        .recent-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .recent-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: rgba(255, 209, 102, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            color: var(--gold);
        }

        .recent-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--light);
        }

        .recent-list {
            list-style: none;
        }

        .recent-item {
            display: flex;
            align-items: center;
            padding: 0.8rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .recent-item:last-child {
            border-bottom: none;
        }

        .recent-type {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            background: rgba(42, 111, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.8rem;
            color: var(--primary);
            font-size: 0.7rem;
        }

        .recent-value {
            flex: 1;
            font-size: 0.8rem;
            color: var(--light);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .recent-time {
            font-size: 0.7rem;
            color: var(--gray);
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 6px;
            color: white;
            font-weight: 500;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            max-width: 400px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            background: var(--secondary);
            border-left: 4px solid var(--neon-green);
        }

        .toast.error {
            background: var(--accent);
            border-left: 4px solid #ff3b3b;
        }

        .toast.info {
            background: var(--primary);
            border-left: 4px solid var(--neon-blue);
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--light);
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Animations */
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(42, 111, 255, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(42, 111, 255, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(42, 111, 255, 0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-in {
            animation: slideIn 0.5s ease-out;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                width: 200px;
            }
            .main-content {
                margin-left: 200px;
            }
            .submission-layout {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .platform-layout {
                flex-direction: column;
            }
            .sidebar {
                position: relative;
                width: 100%;
                height: auto;
            }
            .main-content {
                margin-left: 0;
            }
            .form-grid {
                grid-template-columns: 1fr;
            }
            .analysis-tabs {
                flex-direction: column;
            }
        }
        /* Colorful Analysis Styling */
.highlight-text {
    color: var(--primary);
    font-weight: 600;
    background: linear-gradient(90deg, rgba(42, 111, 255, 0.1), rgba(42, 111, 255, 0.05));
    padding: 2px 6px;
    border-radius: 3px;
    border-left: 3px solid var(--primary);
    margin: 0 2px;
}

.highlight-label {
    color: var(--accent);
    font-weight: 700;
    background: rgba(255, 107, 107, 0.1);
    padding: 2px 8px;
    border-radius: 4px;
    display: inline-block;
    margin-right: 5px;
    font-size: 0.9em;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.styled-list {
    list-style: none;
    margin: 1rem 0;
    padding-left: 0;
}

.styled-list li {
    padding: 0.8rem 1rem;
    margin-bottom: 0.5rem;
    background: rgba(10, 15, 28, 0.5);
    border-radius: 6px;
    border-left: 4px solid var(--secondary);
    position: relative;
    transition: var(--transition);
}

.styled-list li:hover {
    background: rgba(10, 15, 28, 0.7);
    transform: translateX(3px);
    border-left-color: var(--primary);
}

.styled-list li:before {
    content: '‚ñ∂';
    color: var(--secondary);
    position: absolute;
    left: 0.5rem;
    font-size: 0.8em;
}

.section-subheader {
    color: var(--neon-blue);
    font-size: 1.1rem;
    margin: 1.5rem 0 0.8rem 0;
    padding-bottom: 0.3rem;
    border-bottom: 1px solid rgba(0, 245, 255, 0.3);
    font-weight: 600;
}

.content-header {
    color: var(--purple);
    font-size: 1rem;
    margin: 1.2rem 0 0.5rem 0;
    font-weight: 600;
}

.content-paragraph {
    color: var(--light);
    line-height: 1.7;
    margin-bottom: 1rem;
    padding: 0.5rem 0;
    border-left: 2px solid transparent;
    padding-left: 1rem;
}

.content-paragraph:hover {
    border-left-color: rgba(255, 255, 255, 0.1);
}

.no-content-message {
    color: var(--gray);
    font-style: italic;
    text-align: center;
    padding: 2rem;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 6px;
    border: 1px dashed rgba(255, 255, 255, 0.1);
}

/* Full Analysis Styling */
.formatted-analysis {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    padding: 1.5rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
    font-family: 'Source Code Pro', monospace;
    line-height: 1.7;
}

.section-header-colored {
    color: var(--primary);
    font-size: 1.2rem;
    margin: 1.8rem 0 1rem 0;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid rgba(42, 111, 255, 0.3);
    font-weight: 700;
}

.section-subheader-colored {
    color: var(--secondary);
    font-size: 1.1rem;
    margin: 1.5rem 0 0.8rem 0;
    font-weight: 600;
}

.highlight-inline {
    color: var(--accent);
    font-weight: 600;
    background: rgba(255, 107, 107, 0.1);
    padding: 1px 4px;
    border-radius: 3px;
}

.colorful-list {
    list-style: none;
    margin: 1rem 0;
    padding-left: 0;
}

.colorful-bullet {
    padding: 0.7rem 1rem;
    margin-bottom: 0.5rem;
    background: rgba(42, 111, 255, 0.1);
    border-radius: 5px;
    border-left: 4px solid var(--primary);
    position: relative;
}

.colorful-bullet:before {
    content: 'üõ°Ô∏è';
    margin-right: 0.5rem;
    color: var(--primary);
}

.numbered-bullet {
    padding: 0.7rem 1rem;
    margin-bottom: 0.5rem;
    background: rgba(0, 212, 170, 0.1);
    border-radius: 5px;
    border-left: 4px solid var(--secondary);
    position: relative;
    counter-increment: item;
}

.numbered-bullet:before {
    content: counter(item) '.';
    color: var(--secondary);
    font-weight: 600;
    margin-right: 0.5rem;
}

/* Icon colors for different tabs */
.section-icon.overview-icon {
    background: rgba(42, 111, 255, 0.2) !important;
    color: var(--primary) !important;
}

.section-icon.soc-icon {
    background: rgba(255, 107, 107, 0.2) !important;
    color: var(--accent) !important;
}

.section-icon.maintenance-icon {
    background: rgba(0, 212, 170, 0.2) !important;
    color: var(--secondary) !important;
}

.section-icon.controls-icon {
    background: rgba(157, 78, 221, 0.2) !important;
    color: var(--purple) !important;
}

.section-icon.raw-icon {
    background: rgba(255, 209, 102, 0.2) !important;
    color: var(--gold) !important;
}

/* Color variations for different content types */
.styled-content .highlight-text.risk-high {
    color: var(--accent);
    background: rgba(255, 107, 107, 0.15);
    border-left-color: var(--accent);
}

.styled-content .highlight-text.risk-medium {
    color: var(--gold);
    background: rgba(255, 209, 102, 0.15);
    border-left-color: var(--gold);
}

.styled-content .highlight-text.risk-low {
    color: var(--secondary);
    background: rgba(0, 212, 170, 0.15);
    border-left-color: var(--secondary);
}

.styled-content .highlight-text.tool {
    color: var(--purple);
    background: rgba(157, 78, 221, 0.1);
    border-left-color: var(--purple);
}
    </style>
</head>
<body>
    <!-- Matrix Background -->
    <canvas class="matrix-bg" id="matrixCanvas"></canvas>
    <div class="grid-bg"></div>

    <!-- Toast Notifications -->
    <div id="toastContainer"></div>

    <!-- Header -->
    <header>
        <div class="container header-container">
            <div class="logo">
                <i class="fas fa-shield-alt"></i>
                CTI-Blockchain
            </div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="platform.html">Platform</a></li>
                <li><a href="threat-feed.html">Threat Feed</a></li>
                <li><a href="ioc-submission.html" class="active">IOC Submission</a></li>
                <li><a href="#">How It Works</a></li>
                <li><a href="#">About</a></li>
            </ul>
            <div class="auth-buttons">
                <div class="user-profile">
                    <span style="margin-right: 1rem; color: var(--gray);">Analyst_01</span>
                </div>
                <a href="#" class="btn btn-outline"><i class="fas fa-sign-out-alt"></i> Log Out</a>
            </div>
        </div>
    </header>

    <!-- Platform Layout -->
    <div class="platform-layout">
        <!-- Sidebar -->
        <div class="sidebar">
            <ul class="sidebar-menu">
                <li><a href="Platform.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                <li><a href="ThreatFeed.html"><i class="fas fa-broadcast-tower"></i> Threat Feed</a></li>
                <li><a href="ThreatSearch.html"><i class="fas fa-search"></i> Threat Search</a></li>
                <li><a href="IocSubmission.html" class="active"><i class="fas fa-share-alt"></i> IOC Submission</a></li>
                 <li><a href="agent.html" ><i class="fas fa-robot"></i> SOC Agent</a></li>
                <li><a href="BlockChainExplorer.html"><i class="fas fa-project-diagram"></i> Blockchain Explorer</a></li>
                <li><a href="Analytics.html"><i class="fas fa-chart-bar"></i> Analytics</a></li>
                <li><a href="Settings.html"><i class="fas fa-cog"></i> Settings</a></li>
            </ul>

            <div class="sidebar-section">
                <h3>Submission Templates</h3>
                <ul class="sidebar-menu">
                    <li><a href="#" data-template="ip"><i class="fas fa-file-alt"></i> IP Address</a></li>
                    <li><a href="#" data-template="domain"><i class="fas fa-file-alt"></i> Domain</a></li>
                    <li><a href="#" data-template="hash-md5"><i class="fas fa-file-alt"></i> File Hash</a></li>
                    <li><a href="#" data-template="url"><i class="fas fa-file-alt"></i> URL</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <h3>My Submissions</h3>
                <ul class="sidebar-menu">
                    <li><a href="#" id="submissionHistory"><i class="fas fa-history"></i> Submission History</a></li>
                    <li><a href="#"><i class="fas fa-star"></i> Saved Drafts</a></li>
                    <li><a href="#"><i class="fas fa-chart-line"></i> Submission Stats</a></li>
                </ul>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="page-header">
                <h1 class="page-title">Submit Indicator of Compromise</h1>
                <div class="page-actions">
                    <button class="btn btn-warning" id="getAnalysisBtn">
                        <i class="fas fa-robot"></i> Get AI Analysis
                    </button>
                    <button class="btn btn-outline" id="viewHistoryBtn"><i class="fas fa-history"></i> Submission History</button>
                    <button class="btn btn-outline"><i class="fas fa-question-circle"></i> Help</button>
                </div>
            </div>

            <div class="submission-layout">
                <!-- Submission Form -->
                <div class="submission-form">
                    <div class="form-header">
                        <h2 class="form-title">New IOC Submission</h2>
                        <p class="form-subtitle">Submit threat indicators to the blockchain for anonymous, immutable sharing with the security community</p>
                    </div>

                    <form id="iocForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">IOC Type <span class="required">*</span></label>
                                <select class="form-control" id="iocType" required>
                                    <option value="">Select IOC Type</option>
                                    <option value="ip">IP Address</option>
                                    <option value="domain">Domain</option>
                                    <option value="url">URL</option>
                                    <option value="hash-md5">File Hash (MD5)</option>
                                    <option value="hash-sha1">File Hash (SHA-1)</option>
                                    <option value="hash-sha256">File Hash (SHA-256)</option>
                                    <option value="email">Email Address</option>
                                    <option value="cidr">CIDR Block</option>
                                    <option value="asn">AS Number</option>
                                </select>
                                <div class="form-hint">Select the type of indicator you're submitting</div>
                                <div class="form-error" id="typeError">Please select an IOC type</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Threat Level <span class="required">*</span></label>
                                <select class="form-control" id="threatLevel" required>
                                    <option value="">Select Threat Level</option>
                                    <option value="low">Low - Suspicious activity</option>
                                    <option value="medium">Medium - Malicious activity</option>
                                    <option value="high">High - Active compromise</option>
                                    <option value="critical">Critical - Immediate threat</option>
                                </select>
                                <div class="form-hint">Assess the severity of this threat</div>
                                <div class="form-error" id="levelError">Please select a threat level</div>
                            </div>

                            <div class="form-group full-width">
                                <label class="form-label">IOC Value <span class="required">*</span></label>
                                <input type="text" class="form-control" id="iocValue" placeholder="Enter the indicator value (e.g., 192.168.1.1 or malicious-domain.com)" required>
                                <div class="form-hint" id="valueHint">Enter the actual indicator value based on the selected type</div>
                                <div class="form-error" id="valueError">Please enter a valid IOC value</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">First Seen</label>
                                <input type="datetime-local" class="form-control" id="firstSeen">
                                <div class="form-hint">When was this indicator first observed?</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Last Seen</label>
                                <input type="datetime-local" class="form-control" id="lastSeen">
                                <div class="form-hint">When was this indicator most recently observed?</div>
                            </div>

                            <div class="form-group full-width">
                                <label class="form-label">Description</label>
                                <textarea class="form-control" id="description" rows="3" placeholder="Provide context about this threat indicator (attack type, target industry, TTPs, etc.)"></textarea>
                                <div class="form-hint">Detailed context helps other analysts understand and respond to this threat</div>
                            </div>

                            <div class="form-group full-width">
                                <label class="form-label">Tags</label>
                                <input type="text" class="form-control" id="tags" placeholder="Enter tags separated by commas (e.g., ransomware, financial, apt-group)">
                                <div class="form-hint">Add relevant tags to categorize this threat</div>
                            </div>

                            <div class="form-group full-width">
                                <label class="form-label">Confidence Level</label>
                                <div style="display: flex; align-items: center; gap: 1rem;">
                                    <input type="range" class="form-control" id="confidence" min="0" max="100" value="80" style="flex: 1;">
                                    <span id="confidenceValue">80%</span>
                                </div>
                                <div class="form-hint">How confident are you in this indicator's maliciousness?</div>
                            </div>

                            <div class="form-group full-width">
                                <div class="checkbox-group">
                                    <input type="checkbox" class="checkbox" id="anonymize" checked>
                                    <label class="checkbox-label" for="anonymize">Submit anonymously (recommended)</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" class="checkbox" id="agreeTerms" required>
                                    <label class="checkbox-label" for="agreeTerms">I confirm this is a legitimate threat indicator and agree to the <a href="#" style="color: var(--primary);">submission terms</a></label>
                                </div>
                                <div class="form-error" id="termsError">You must agree to the submission terms</div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-outline" id="resetBtn">Reset Form</button>
                            <button type="button" class="btn btn-outline" id="saveDraftBtn">Save Draft</button>
                            <button type="submit" class="btn btn-primary" id="submitBtn">
                                <span id="submitText">Submit to Blockchain</span>
                                <span id="submitSpinner" class="spinner" style="display: none;"></span>
                            </button>
                        </div>
                    </form>

                    <!-- AI Analysis Section -->
                    <div class="ai-analysis" id="aiAnalysis">
                        <div class="ai-analysis-header">
                            <div class="ai-analysis-icon">
                                <i class="fas fa-robot"></i>
                            </div>
                            <h3 class="ai-analysis-title">AI Threat Analysis</h3>
                        </div>

                        <div class="analysis-tabs">
                            <button class="analysis-tab active" data-tab="overview">Overview</button>
                            <button class="analysis-tab" data-tab="soc">SOC Actions</button>
                            <button class="analysis-tab" data-tab="maintenance">Maintenance Ideas</button>
                            <button class="analysis-tab" data-tab="controls">Security Controls</button>
                            <button class="analysis-tab" data-tab="raw">Full Analysis</button>
                        </div>

                        <div class="analysis-content active" id="overviewTab">
                            <div class="analysis-loading" id="overviewLoading">
                                <div class="spinner"></div>
                                <p>Analyzing IOC threat summary...</p>
                            </div>
                            <div id="overviewContent" style="display: none;">
                                <!-- Content will be populated by AI agent -->
                            </div>
                        </div>

                        <div class="analysis-content" id="socTab">
                            <div class="analysis-loading" id="socLoading">
                                <div class="spinner"></div>
                                <p>Generating SOC action recommendations...</p>
                            </div>
                            <div id="socContent" style="display: none;">
                                <!-- Content will be populated by AI agent -->
                            </div>
                        </div>

                        <div class="analysis-content" id="maintenanceTab">
                            <div class="analysis-loading" id="maintenanceLoading">
                                <div class="spinner"></div>
                                <p>Creating maintenance and hardening ideas...</p>
                            </div>
                            <div id="maintenanceContent" style="display: none;">
                                <!-- Content will be populated by AI agent -->
                            </div>
                        </div>

                        <div class="analysis-content" id="controlsTab">
                            <div class="analysis-loading" id="controlsLoading">
                                <div class="spinner"></div>
                                <p>Preparing security control recommendations...</p>
                            </div>
                            <div id="controlsContent" style="display: none;">
                                <!-- Content will be populated by AI agent -->
                            </div>
                        </div>

                        <div class="analysis-content" id="rawTab">
                            <div class="analysis-loading" id="rawLoading">
                                <div class="spinner"></div>
                                <p>Preparing full analysis report...</p>
                            </div>
                            <div id="rawContent" style="display: none;">
                                <!-- Content will be populated by AI agent -->
                            </div>
                        </div>

                        <div class="analysis-actions">
                            <button class="btn btn-outline" id="copyAnalysisBtn">
                                <i class="fas fa-copy"></i> Copy Analysis
                            </button>
                            <button class="btn btn-outline" id="exportAnalysisBtn">
                                <i class="fas fa-download"></i> Export as PDF
                            </button>
                            <button class="btn btn-primary" id="applyRecommendationsBtn">
                                <i class="fas fa-check"></i> Apply Recommendations
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Submission Sidebar -->
                <div class="submission-sidebar">
                    <!-- Submission Guide -->
                    <div class="submission-guide">
                        <div class="guide-header">
                            <div class="guide-icon">
                                <i class="fas fa-info-circle"></i>
                            </div>
                            <h3 class="guide-title">Submission Guide</h3>
                        </div>
                        <ul class="guide-list">
                            <li class="guide-item">
                                <div class="guide-bullet">1</div>
                                <div class="guide-content">
                                    <h4>Verify Your Indicator</h4>
                                    <p>Ensure the IOC is confirmed malicious before submission to maintain data quality.</p>
                                </div>
                            </li>
                            <li class="guide-item">
                                <div class="guide-bullet">2</div>
                                <div class="guide-content">
                                    <h4>Provide Context</h4>
                                    <p>Include relevant details about the attack context, TTPs, and target industry.</p>
                                </div>
                            </li>
                            <li class="guide-item">
                                <div class="guide-bullet">3</div>
                                <div class="guide-content">
                                    <h4>Assess Confidence</h4>
                                    <p>Rate your confidence level based on evidence and verification methods.</p>
                                </div>
                            </li>
                            <li class="guide-item">
                                <div class="guide-bullet">4</div>
                                <div class="guide-content">
                                    <h4>Review Before Submitting</h4>
                                    <p>All submissions are immutable once written to the blockchain.</p>
                                </div>
                            </li>
                        </ul>
                    </div>

                    <!-- Blockchain Preview -->
                    <div class="blockchain-preview">
                        <div class="preview-header">
                            <div class="preview-icon">
                                <i class="fas fa-cube"></i>
                            </div>
                            <h3 class="preview-title">Blockchain Preview</h3>
                        </div>
                        <div class="preview-content" id="blockchainPreview">
                            <div class="preview-line">{</div>
                            <div class="preview-line">&nbsp;&nbsp;"<span class="preview-key">type</span>": "<span id="previewType">-</span>",</div>
                            <div class="preview-line">&nbsp;&nbsp;"<span class="preview-key">value</span>": "<span id="previewValue">-</span>",</div>
                            <div class="preview-line">&nbsp;&nbsp;"<span class="preview-key">threatLevel</span>": "<span id="previewLevel">-</span>",</div>
                            <div class="preview-line">&nbsp;&nbsp;"<span class="preview-key">confidence</span>": <span id="previewConfidence">-</span>,</div>
                            <div class="preview-line">&nbsp;&nbsp;"<span class="preview-key">timestamp</span>": "<span id="previewTimestamp">-</span>",</div>
                            <div class="preview-line">&nbsp;&nbsp;"<span class="preview-key">submitter</span>": "<span id="previewSubmitter">Anonymous</span>"</div>
                            <div class="preview-line">}</div>
                        </div>
                    </div>

                    <!-- Submission Status -->
                    <div class="submission-status" id="submissionStatus">
                        <div class="status-header">
                            <div class="status-icon">
                                <i class="fas fa-sync-alt"></i>
                            </div>
                            <h3 class="status-title">Submission Status</h3>
                        </div>
                        <div class="status-timeline">
                            <div class="status-step">
                                <div class="status-bullet completed" id="step1"></div>
                                <div class="status-info">
                                    <h4>Form Validation</h4>
                                    <p>All fields validated successfully</p>
                                </div>
                            </div>
                            <div class="status-step">
                                <div class="status-bullet" id="step2"></div>
                                <div class="status-info">
                                    <h4>API Submission</h4>
                                    <p>Sending data to backend...</p>
                                </div>
                            </div>
                            <div class="status-step">
                                <div class="status-bullet" id="step3"></div>
                                <div class="status-info">
                                    <h4>Blockchain Transaction</h4>
                                    <p>Writing to distributed ledger...</p>
                                </div>
                            </div>
                            <div class="status-step">
                                <div class="status-bullet" id="step4"></div>
                                <div class="status-info">
                                    <h4>Complete</h4>
                                    <p>IOC available in threat feed</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Submissions -->
                    <div class="recent-submissions">
                        <div class="recent-header">
                            <div class="recent-icon">
                                <i class="fas fa-history"></i>
                            </div>
                            <h3 class="recent-title">Recent Submissions</h3>
                        </div>
                        <ul class="recent-list" id="recentSubmissionsList">
                            <li class="recent-item">
                                <div class="recent-type">IP</div>
                                <div class="recent-value">185.22.33.45</div>
                                <div class="recent-time">2h ago</div>
                            </li>
                            <li class="recent-item">
                                <div class="recent-type">DOM</div>
                                <div class="recent-value">malicious-domain.com</div>
                                <div class="recent-time">5h ago</div>
                            </li>
                            <li class="recent-item">
                                <div class="recent-type">HASH</div>
                                <div class="recent-value">abc123def456...</div>
                                <div class="recent-time">1d ago</div>
                            </li>
                            <li class="recent-item">
                                <div class="recent-type">URL</div>
                                <div class="recent-value">phishing-site.net/login</div>
                                <div class="recent-time">1d ago</div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

        <script>
            // API Configuration
            const API_BASE_URL = 'http://localhost:3000/api';

            // Matrix Background
            const canvas = document.getElementById('matrixCanvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789$#@%&*";
            const charArray = chars.split("");
            
            const fontSize = 12;
            const columns = canvas.width / fontSize;
            
            const drops = [];
            for(let i = 0; i < columns; i++) {
                drops[i] = 1;
            }
            
            function drawMatrix() {
                ctx.fillStyle = "rgba(5, 8, 17, 0.04)";
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = "#0F0";
                ctx.font = fontSize + "px monospace";
                
                for(let i = 0; i < drops.length; i++) {
                    const text = charArray[Math.floor(Math.random() * charArray.length)];
                    ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                    
                    if(drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                        drops[i] = 0;
                    }
                    
                    drops[i]++;
                }
            }
            
            setInterval(drawMatrix, 35);

            // Form Validation and Interaction
            const iocForm = document.getElementById('iocForm');
            const iocType = document.getElementById('iocType');
            const threatLevel = document.getElementById('threatLevel');
            const iocValue = document.getElementById('iocValue');
            const confidence = document.getElementById('confidence');
            const confidenceValue = document.getElementById('confidenceValue');
            const blockchainPreview = document.getElementById('blockchainPreview');
            const submissionStatus = document.getElementById('submissionStatus');
            const submitBtn = document.getElementById('submitBtn');
            const submitText = document.getElementById('submitText');
            const submitSpinner = document.getElementById('submitSpinner');
            const aiAnalysis = document.getElementById('aiAnalysis');
            const getAnalysisBtn = document.getElementById('getAnalysisBtn');

            // Update confidence value display
            confidence.addEventListener('input', function() {
                confidenceValue.textContent = this.value + '%';
                updateBlockchainPreview();
            });

            // Update blockchain preview on form changes
            iocType.addEventListener('change', updateBlockchainPreview);
            threatLevel.addEventListener('change', updateBlockchainPreview);
            iocValue.addEventListener('input', updateBlockchainPreview);
            document.getElementById('anonymize').addEventListener('change', updateBlockchainPreview);

            // Update value hint based on IOC type
            iocType.addEventListener('change', function() {
                const valueHint = document.getElementById('valueHint');
                const type = this.value;
                
                let hintText = 'Enter the actual indicator value based on the selected type';
                
                switch(type) {
                    case 'ip':
                        hintText = 'Enter a valid IP address (e.g., 192.168.1.1 or 2001:db8::1)';
                        break;
                    case 'domain':
                        hintText = 'Enter a domain name (e.g., malicious-domain.com)';
                        break;
                    case 'url':
                        hintText = 'Enter a full URL (e.g., https://malicious-site.com/path)';
                        break;
                    case 'hash-md5':
                        hintText = 'Enter a 32-character MD5 hash (e.g., 5d41402abc4b2a76b9719d911017c592)';
                        break;
                    case 'hash-sha1':
                        hintText = 'Enter a 40-character SHA-1 hash';
                        break;
                    case 'hash-sha256':
                        hintText = 'Enter a 64-character SHA-256 hash';
                        break;
                    case 'email':
                        hintText = 'Enter an email address (e.g., attacker@malicious-domain.com)';
                        break;
                    case 'cidr':
                        hintText = 'Enter a CIDR block (e.g., 192.168.1.0/24)';
                        break;
                    case 'asn':
                        hintText = 'Enter an AS number (e.g., AS12345)';
                        break;
                }
                
                valueHint.textContent = hintText;
                updateBlockchainPreview();
            });

            // Update blockchain preview function
            function updateBlockchainPreview() {
                document.getElementById('previewType').textContent = iocType.options[iocType.selectedIndex].text || '-';
                document.getElementById('previewValue').textContent = iocValue.value || '-';
                document.getElementById('previewLevel').textContent = threatLevel.options[threatLevel.selectedIndex].text.split(' - ')[0] || '-';
                document.getElementById('previewConfidence').textContent = confidence.value;
                document.getElementById('previewTimestamp').textContent = new Date().toISOString();
                
                const isAnonymous = document.getElementById('anonymize').checked;
                document.getElementById('previewSubmitter').textContent = isAnonymous ? 'Anonymous' : 'Analyst_01';
            }

            // Form validation
            function validateForm() {
                let isValid = true;
                
                // Clear previous errors
                document.querySelectorAll('.form-error').forEach(error => {
                    error.style.display = 'none';
                });
                document.querySelectorAll('.form-control').forEach(input => {
                    input.classList.remove('error');
                });
                
                // Validate IOC Type
                if (!iocType.value) {
                    document.getElementById('typeError').style.display = 'block';
                    iocType.classList.add('error');
                    isValid = false;
                }
                
                // Validate Threat Level
                if (!threatLevel.value) {
                    document.getElementById('levelError').style.display = 'block';
                    threatLevel.classList.add('error');
                    isValid = false;
                }
                
                // Validate IOC Value
                if (!iocValue.value) {
                    document.getElementById('valueError').style.display = 'block';
                    iocValue.classList.add('error');
                    isValid = false;
                } else {
                    // Additional validation based on IOC type
                    const type = iocType.value;
                    const value = iocValue.value.trim();
                    
                    switch(type) {
                        case 'ip':
                            if (!isValidIP(value)) {
                                document.getElementById('valueError').textContent = 'Please enter a valid IP address';
                                document.getElementById('valueError').style.display = 'block';
                                iocValue.classList.add('error');
                                isValid = false;
                            }
                            break;
                        case 'domain':
                            if (!isValidDomain(value)) {
                                document.getElementById('valueError').textContent = 'Please enter a valid domain name';
                                document.getElementById('valueError').style.display = 'block';
                                iocValue.classList.add('error');
                                isValid = false;
                            }
                            break;
                        case 'url':
                            if (!isValidURL(value)) {
                                document.getElementById('valueError').textContent = 'Please enter a valid URL';
                                document.getElementById('valueError').style.display = 'block';
                                iocValue.classList.add('error');
                                isValid = false;
                            }
                            break;
                        case 'hash-md5':
                            if (!isValidMD5(value)) {
                                document.getElementById('valueError').textContent = 'Please enter a valid 32-character MD5 hash';
                                document.getElementById('valueError').style.display = 'block';
                                iocValue.classList.add('error');
                                isValid = false;
                            }
                            break;
                        case 'hash-sha256':
                            if (!isValidSHA256(value)) {
                                document.getElementById('valueError').textContent = 'Please enter a valid 64-character SHA-256 hash';
                                document.getElementById('valueError').style.display = 'block';
                                iocValue.classList.add('error');
                                isValid = false;
                            }
                            break;
                    }
                }
                
                // Validate Terms Agreement
                if (!document.getElementById('agreeTerms').checked) {
                    document.getElementById('termsError').style.display = 'block';
                    isValid = false;
                }
                
                return isValid;
            }

            // Validation helper functions
            function isValidIP(ip) {
                const ipv4Regex = /^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
                const ipv6Regex = /^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/;
                return ipv4Regex.test(ip) || ipv6Regex.test(ip);
            }

            function isValidDomain(domain) {
                const domainRegex = /^[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;
                return domainRegex.test(domain);
            }

            function isValidURL(url) {
                try {
                    new URL(url);
                    return true;
                } catch {
                    return false;
                }
            }

            function isValidMD5(hash) {
                return /^[a-fA-F0-9]{32}$/.test(hash);
            }

            function isValidSHA256(hash) {
                return /^[a-fA-F0-9]{64}$/.test(hash);
            }

            // Toast notification system
            function showToast(message, type = 'info', duration = 5000) {
                const toastContainer = document.getElementById('toastContainer');
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                
                toastContainer.appendChild(toast);
                
                // Trigger animation
                setTimeout(() => toast.classList.add('show'), 10);
                
                // Remove toast after duration
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 300);
                }, duration);
            }

            // AI Analysis Integration
           // AI Analysis Integration
async function getAIAnalysis() {
    // Validate form before getting analysis
    if (!validateForm()) {
        showToast('Please fill in all required fields first', 'error');
        return;
    }

    // Show AI analysis section
    aiAnalysis.style.display = 'block';
    aiAnalysis.scrollIntoView({ behavior: 'smooth' });
    
    // Disable get analysis button
    getAnalysisBtn.disabled = true;
    getAnalysisBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing...';

    // Show loading states for all tabs
    document.querySelectorAll('.analysis-loading').forEach(loading => {
        loading.style.display = 'block';
    });
    document.querySelectorAll('.analysis-content > div:not(.analysis-loading)').forEach(content => {
        content.style.display = 'none';
    });

    try {
        // Prepare data for AI analysis
        const formData = {
            type: iocType.value,
            value: iocValue.value.trim(),
            threatLevel: threatLevel.value,
            confidence: parseInt(confidence.value),
            description: document.getElementById('description').value.trim(),
            tags: document.getElementById('tags').value.split(',').map(tag => tag.trim()).filter(tag => tag),
            firstSeen: document.getElementById('firstSeen').value || null,
            lastSeen: document.getElementById('lastSeen').value || null,
            isAnonymous: document.getElementById('anonymize').checked
        };

        // Call your existing AI analysis endpoint
        const response = await fetch(`${API_BASE_URL}/analyze-ioc/analyze-ioc`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });

        const result = await response.json();

        if (response.ok) {
            // Process and display AI-generated analysis
            processAIAnalysis(result.analysis || result.text || result.response);
            
            showToast('AI analysis generated successfully!', 'success');
        } else {
            throw new Error(result.error || 'AI analysis request failed');
        }
    } catch (error) {
        console.error('AI analysis error:', error);
        showToast(`Failed to get AI analysis: ${error.message}`, 'error');
        
        // Display mock data as fallback
        displayMockAnalysis();
    } finally {
        // Re-enable get analysis button
        getAnalysisBtn.disabled = false;
        getAnalysisBtn.innerHTML = '<i class="fas fa-robot"></i> Get AI Analysis';
    }
}

// Process AI analysis response and organize into sections
// Process AI analysis response and organize into sections
// Process AI analysis response and organize into sections
// Process AI analysis response and organize into sections
function processAIAnalysis(analysisText) {
    // Hide all loading states
    document.querySelectorAll('.analysis-loading').forEach(loading => {
        loading.style.display = 'none';
    });

    // Parse the analysis text into sections
    const sections = parseAIAnalysis(analysisText);
    
    // Display each section in appropriate tab
    displayParsedSections(sections, analysisText);
}

// Get appropriate icon for each tab
function getTabIcon(tabId) {
    switch(tabId) {
        case 'overview': return 'eye';
        case 'soc': return 'user-shield';
        case 'maintenance': return 'tools';
        case 'controls': return 'shield-alt';
        case 'raw': return 'file-alt';
        default: return 'info-circle';
    }
}

// Parse AI analysis text with improved logic
function parseAIAnalysis(text) {
    const sections = {
        threatSummary: '',
        attackExplanation: '',
        riskLevel: '',
        socActions: '',
        maintenanceIdeas: '',
        securityControls: '',
        conclusion: ''
    };

    // Clean up the text first
    let cleanText = text.trim();
    
    // Remove duplicate sections and fix common issues
    cleanText = cleanText.replace(/###\s+/g, '## ');
    cleanText = cleanText.replace(/\*\*\*/g, '**');
    
    // Split by numbered sections or double hash headers
    const sectionRegex = /(?:^|\n)(?:\d+\.\s+|\#\#\s+)([^\n]+)/g;
    let matches;
    let lastIndex = 0;
    let currentSection = '';
    let currentContent = '';

    // Find all section headers
    const sectionHeaders = [];
    while ((matches = sectionRegex.exec(cleanText)) !== null) {
        const header = matches[1].trim();
        const startPos = matches.index;
        
        sectionHeaders.push({
            header: header,
            start: startPos,
            contentStart: matches.index + matches[0].length
        });
    }

    // Process each section
    for (let i = 0; i < sectionHeaders.length; i++) {
        const section = sectionHeaders[i];
        const nextSection = sectionHeaders[i + 1];
        const endPos = nextSection ? nextSection.start : cleanText.length;
        
        // Extract content for this section
        let content = cleanText.substring(section.contentStart, endPos).trim();
        
        // Clean up the content - remove section headers that might be inside
        content = content.replace(/^(?:\d+\.\s+|\#\#\s+).*$/gm, '').trim();
        
        // Map section header to our section keys
        const sectionKey = mapSectionHeader(section.header);
        
        if (sectionKey && content) {
            // Remove any trailing section numbers or headers
            content = content.replace(/\n\d+\.\s+.*$/, '');
            content = content.replace(/\n\#\#\s+.*$/, '');
            
            sections[sectionKey] = content;
        }
    }

    // If sections weren't found with headers, try alternative parsing
    if (!sections.threatSummary && !sections.socActions && !sections.securityControls) {
        return parseByContentPatterns(cleanText);
    }

    return sections;
}

// Map section header to section key
function mapSectionHeader(header) {
    const headerLower = header.toLowerCase().trim();
    
    if (headerLower.includes('threat') && (headerLower.includes('summary') || headerLower.includes('analysis'))) {
        return 'threatSummary';
    } else if (headerLower.includes('attack') && headerLower.includes('explanation')) {
        return 'attackExplanation';
    } else if (headerLower.includes('risk') && headerLower.includes('level')) {
        return 'riskLevel';
    } else if ((headerLower.includes('required') || headerLower.includes('soc')) && headerLower.includes('action')) {
        return 'socActions';
    } else if (headerLower.includes('maintain') || headerLower.includes('customer') || headerLower.includes('company')) {
        return 'maintenanceIdeas';
    } else if (headerLower.includes('security') && headerLower.includes('control')) {
        return 'securityControls';
    } else if (headerLower.includes('conclusion')) {
        return 'conclusion';
    }
    
    return null;
}

// Alternative parsing by content patterns
function parseByContentPatterns(text) {
    const sections = {
        threatSummary: '',
        attackExplanation: '',
        riskLevel: '',
        socActions: '',
        maintenanceIdeas: '',
        securityControls: '',
        conclusion: ''
    };

    const lines = text.split('\n');
    let currentSection = '';
    let currentContent = [];

    for (let i = 0; i < lines.length; i++) {
        const line = lines[i].trim();
        
        if (!line) continue;

        // Detect section starts
        if (line.match(/^1\./i) || line.toLowerCase().includes('threat summary') || 
            (line.toLowerCase().includes('provided ioc') && !currentSection)) {
            if (currentSection) saveSection(sections, currentSection, currentContent);
            currentSection = 'threatSummary';
            currentContent = [];
            // Extract the actual content after the header
            const contentStart = line.indexOf('Threat Summary') > -1 ? 
                line.indexOf('Threat Summary') + 'Threat Summary'.length : 
                line.indexOf('1.') > -1 ? line.indexOf('1.') + 2 : 0;
            if (contentStart > 0) {
                const content = line.substring(contentStart).trim();
                if (content) currentContent.push(content);
            }
        }
        else if (line.match(/^2\./i) || line.toLowerCase().includes('attack explanation')) {
            if (currentSection) saveSection(sections, currentSection, currentContent);
            currentSection = 'attackExplanation';
            currentContent = [];
        }
        else if (line.match(/^3\./i) || line.toLowerCase().includes('risk level')) {
            if (currentSection) saveSection(sections, currentSection, currentContent);
            currentSection = 'riskLevel';
            currentContent = [];
        }
        else if (line.match(/^4\./i) || (line.toLowerCase().includes('required') && 
                 (line.toLowerCase().includes('soc') || line.toLowerCase().includes('action')))) {
            if (currentSection) saveSection(sections, currentSection, currentContent);
            currentSection = 'socActions';
            currentContent = [];
        }
        else if (line.match(/^5\./i) || line.toLowerCase().includes('maintaining') || 
                 line.toLowerCase().includes('maintenance')) {
            if (currentSection) saveSection(sections, currentSection, currentContent);
            currentSection = 'maintenanceIdeas';
            currentContent = [];
            // Remove "for the Customer's Company" from the content
            if (line.toLowerCase().includes('for the customer')) {
                continue;
            }
        }
        else if (line.match(/^6\./i) || line.toLowerCase().includes('security control') ||
                 line.toLowerCase().includes('recommended security')) {
            if (currentSection) saveSection(sections, currentSection, currentContent);
            currentSection = 'securityControls';
            currentContent = [];
        }
        else if (line.match(/^7\./i) || line.toLowerCase().includes('conclusion')) {
            if (currentSection) saveSection(sections, currentSection, currentContent);
            currentSection = 'conclusion';
            currentContent = [];
        }
        else if (currentSection) {
            currentContent.push(line);
        }
    }

    // Save the last section
    if (currentSection) {
        saveSection(sections, currentSection, currentContent);
    }

    return sections;
}

// Save section content
function saveSection(sections, sectionKey, contentArray) {
    if (contentArray.length > 0) {
        let content = contentArray.join('\n').trim();
        
        // Clean up the content
        content = content.replace(/^(?:\d+\.\s+|\#\#\s+).*$/gm, '').trim();
        content = content.replace(/^for the Customer's Company$/i, '').trim();
        content = content.replace(/^###\s*/gm, '').trim();
        
        sections[sectionKey] = content;
    }
}

// Display parsed sections in tabs
function displayParsedSections(sections, fullText) {
    console.log('Parsed sections:', sections); // Debug logging
    
    // Display each section in appropriate tab
    // For Overview tab, combine Threat Summary, Attack Explanation, and Risk Level
    const overviewContent = [];
    if (sections.threatSummary) overviewContent.push(`<h4 style="color: var(--primary); margin-bottom: 0.5rem;">Threat Summary</h4><p>${formatContent(sections.threatSummary)}</p>`);
    if (sections.attackExplanation) overviewContent.push(`<h4 style="color: var(--primary); margin-top: 1.5rem; margin-bottom: 0.5rem;">Attack Explanation</h4><p>${formatContent(sections.attackExplanation)}</p>`);
    if (sections.riskLevel) {
        // Extract and format risk level with badge
        const riskLevelText = sections.riskLevel;
        const riskMatch = riskLevelText.match(/classified as\s+(\w+)/i);
        let formattedRisk = riskLevelText;
        if (riskMatch) {
            const risk = riskMatch[1].toLowerCase();
            const riskClass = `risk-${risk}`;
            formattedRisk = riskLevelText.replace(
                /classified as\s+\w+/i, 
                `classified as: <span class="risk-badge ${riskClass}">${risk.toUpperCase()}</span>`
            );
        }
        overviewContent.push(`<h4 style="color: var(--primary); margin-top: 1.5rem; margin-bottom: 0.5rem;">Risk Level</h4><p>${formatContent(formattedRisk)}</p>`);
    }
    
    displaySectionInTab('overview', 
        overviewContent.length > 0 ? overviewContent.join('') : 'No threat analysis available.', 
        'Threat Analysis'
    );
    
    // SOC Actions tab
    displaySectionInTab('soc', 
        sections.socActions || 'No required SOC actions available.', 
        'Required SOC Actions'
    );
    
    // Maintenance Ideas tab - clean up "for the Customer's Company"
    let maintenanceContent = sections.maintenanceIdeas || '';
    maintenanceContent = maintenanceContent.replace(/^for the Customer's Company\s*/i, '').trim();
    displaySectionInTab('maintenance', 
        maintenanceContent || 'No maintenance ideas available.', 
        'Maintenance Ideas'
    );
    
    // Security Controls tab
    displaySectionInTab('controls', 
        sections.securityControls || 'No recommended security controls available.', 
        'Recommended Security Controls'
    );
    
    // Display full analysis in raw tab
    displayFullAnalysis(fullText);
}

// Format content with proper HTML
// Format content with proper HTML and colorful styling
function formatContent(content) {
    if (!content) return '';
    
    let formatted = content;
    
    // First, convert **bold text** to styled spans
    formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<span class="highlight-text">$1</span>');
    
    // Convert bullet points (now without **)
    formatted = formatted.replace(/^\s*[-*]\s+(.*)$/gm, '<li>$1</li>');
    formatted = formatted.replace(/^\s*\d+\.\s+(.*)$/gm, '<li>$1</li>');
    
    // Handle inline bold formatting that might have been missed
    formatted = formatted.replace(/-\s*\*\*(.*?)\*\*:\s*/g, '- <span class="highlight-label">$1:</span> ');
    
    // Wrap consecutive list items
    const lines = formatted.split('\n');
    let inList = false;
    let result = [];
    
    for (let line of lines) {
        line = line.trim();
        if (!line) continue;
        
        if (line.includes('<li>')) {
            if (!inList) {
                result.push('<ul class="styled-list">');
                inList = true;
            }
            result.push(line);
        } else {
            if (inList) {
                result.push('</ul>');
                inList = false;
            }
            
            // Check for headings (lines ending with colon or containing "###")
            if (line.match(/^#{1,3}\s+/) || line.endsWith(':') || line.endsWith(':')) {
                const isMainHeader = line.match(/^#{1,3}\s+/);
                const headerText = isMainHeader ? line.replace(/^#{1,3}\s+/, '') : line;
                const headerClass = isMainHeader ? 'section-subheader' : 'content-header';
                result.push(`<h4 class="${headerClass}">${headerText}</h4>`);
            } else {
                // Regular paragraph with potential highlights
                result.push(`<p class="content-paragraph">${line}</p>`);
            }
        }
    }
    
    if (inList) {
        result.push('</ul>');
    }
    
    return result.join('\n');
}

// Display a section in a specific tab
function displaySectionInTab(tabId, content, title) {
    const tabContent = document.getElementById(`${tabId}Content`);
    if (tabContent) {
        tabContent.style.display = 'block';
        
        if (!content || content.trim() === '') {
            content = `<p class="no-content-message">No ${title.toLowerCase()} available.</p>`;
        } else {
            content = formatContent(content);
        }
        
        // Determine icon color based on tab
        const iconColor = getTabIconColor(tabId);
        
        // Final HTML with proper structure
        tabContent.innerHTML = `
            <div class="section-header">
                <div class="section-icon" style="background: ${iconColor.background}; color: ${iconColor.color};">
                    <i class="fas fa-${getTabIcon(tabId)}"></i>
                </div>
                <h3 class="section-title">${title}</h3>
            </div>
            <div class="section-content styled-content">
                ${content}
            </div>
        `;
    }
}

// Get icon color based on tab
function getTabIconColor(tabId) {
    switch(tabId) {
        case 'overview': 
            return { background: 'rgba(42, 111, 255, 0.2)', color: 'var(--primary)' };
        case 'soc': 
            return { background: 'rgba(255, 107, 107, 0.2)', color: 'var(--accent)' };
        case 'maintenance': 
            return { background: 'rgba(0, 212, 170, 0.2)', color: 'var(--secondary)' };
        case 'controls': 
            return { background: 'rgba(157, 78, 221, 0.2)', color: 'var(--purple)' };
        case 'raw': 
            return { background: 'rgba(255, 209, 102, 0.2)', color: 'var(--gold)' };
        default: 
            return { background: 'rgba(42, 111, 255, 0.2)', color: 'var(--primary)' };
    }
}

// Display full analysis in raw tab
function displayFullAnalysis(fullText) {
    const rawContent = document.getElementById('rawContent');
    if (rawContent) {
        rawContent.style.display = 'block';
        
        // Format the full analysis with proper HTML
        let formattedText = escapeHtml(fullText);
        
        // Add colorful styling for section headers
        formattedText = formattedText.replace(/(\d+\.\s+[^\n]+)/g, '<h4 class="section-header-colored">$1</h4>');
        formattedText = formattedText.replace(/(##\s+[^\n]+)/g, '<h4 class="section-header-colored">$1</h4>');
        formattedText = formattedText.replace(/(###\s+[^\n]+)/g, '<h4 class="section-subheader-colored">$1</h4>');
        
        // Convert **bold text** to highlighted spans
        formattedText = formattedText.replace(/\*\*(.*?)\*\*/g, '<span class="highlight-inline">$1</span>');
        
        // Convert lists with colorful bullets
        formattedText = formattedText.replace(/^\s*[-*]\s+(.*)$/gm, '<li class="colorful-bullet">$1</li>');
        formattedText = formattedText.replace(/^\s*\d+\.\s+(.*)$/gm, '<li class="numbered-bullet">$1</li>');
        
        // Wrap consecutive list items
        formattedText = formattedText.replace(/(<li[^>]*>.*?<\/li>\s*)+/gs, (match) => {
            return `<ul class="colorful-list">${match}</ul>`;
        });
        
        rawContent.innerHTML = `
            <div class="section-header">
                <div class="section-icon" style="background: rgba(255, 209, 102, 0.2); color: var(--gold);">
                    <i class="fas fa-file-alt"></i>
                </div>
                <h3 class="section-title">Full Analysis Report</h3>
            </div>
            <div class="section-content">
                <div class="formatted-analysis">
${formattedText}
                </div>
            </div>
        `;
    }
}


// HTML escape function
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// Mock analysis for demonstration
function displayMockAnalysis() {
    const mockAnalysis = `1. Threat Summary
The provided IOC (Indicator of Compromise) indicates a low-level threat associated with a brute force attack originating from the IP address 192.168.1.16. The attack is characterized by attempts to gain unauthorized access to user accounts, potentially leading to further malicious activities such as ransomware deployment, spoofing, and social engineering attacks.

2. Attack Explanation
A brute force attack involves systematically trying various combinations of usernames and passwords until the correct credentials are found. This method can be automated, allowing attackers to attempt thousands of combinations in a short period. The presence of tags such as "ransomware," "spoofing," and "reverse shell" suggests that the attacker may be attempting to gain access to sensitive systems or data, which could lead to further exploitation, including deploying malware or stealing information.

3. Risk Level
The risk level associated with this IOC is classified as low. However, it is important to note that while the immediate threat may be low, the potential for escalation exists if the attack is successful. The confidence level of 80% indicates a reasonable certainty that this IOC is associated with malicious activity.

4. Required SOC Actions
- **Monitoring:** Continuously monitor network traffic and logs for any further activity from the IP address 192.168.1.16.
- **Alerting:** Set up alerts for any brute force attempts or unusual login activities associated with this IP.
- **Investigation:** Conduct a thorough investigation to determine if there have been any successful breaches or compromised accounts.
- **Block IP:** Consider blocking the IP address at the firewall level to prevent further attempts.

5. Maintaining Ideas for the Customer's Company
- **User Education:** Conduct training sessions for employees on recognizing social engineering tactics and the importance of strong password policies.
- **Password Policies:** Implement strong password policies that require complex passwords and regular changes.
- **Multi-Factor Authentication (MFA):** Encourage or enforce the use of MFA to add an additional layer of security against unauthorized access.

6. Recommended Security Controls
- **SIEM (Security Information and Event Management):** Deploy a SIEM solution to aggregate logs and provide real-time analysis of security alerts generated by applications and network hardware.
- **EDR (Endpoint Detection and Response):** Utilize EDR solutions to monitor endpoint activities and respond to potential threats in real-time.
- **Firewall:** Ensure that firewalls are configured to block known malicious IP addresses and to monitor for unusual traffic patterns.
- **Email Security:** Implement email security solutions to filter out phishing attempts and malicious attachments that could lead to credential theft.

7. Conclusion
While the IOC associated with the IP address 192.168.1.16 indicates a low-level threat of a brute force attack, it is crucial for the SOC to remain vigilant. Continuous monitoring, user education, and the implementation of robust security controls are essential to mitigate the risk of potential escalation. By taking proactive measures, the organization can enhance its security posture and reduce the likelihood of successful attacks in the future.`;

    processAIAnalysis(mockAnalysis);
}
// Get appropriate icon for each tab
function getTabIcon(tabId) {
    switch(tabId) {
        case 'overview': return 'eye';
        case 'soc': return 'user-shield';
        case 'maintenance': return 'tools';
        case 'controls': return 'shield-alt';
        case 'raw': return 'file-alt';
        default: return 'info-circle';
    }
}

// HTML escape function
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// Tab switching for AI analysis
document.querySelectorAll('.analysis-tab').forEach(tab => {
    tab.addEventListener('click', function() {
        const tabId = this.getAttribute('data-tab');
        
        // Update active tab
        document.querySelectorAll('.analysis-tab').forEach(t => {
            t.classList.remove('active');
        });
        this.classList.add('active');
        
        // Show corresponding content
        document.querySelectorAll('.analysis-content').forEach(content => {
            content.classList.remove('active');
        });
        document.getElementById(`${tabId}Tab`).classList.add('active');
    });
});
            // Copy analysis to clipboard
            document.getElementById('copyAnalysisBtn').addEventListener('click', function() {
                const activeTab = document.querySelector('.analysis-content.active');
                const text = activeTab.textContent || activeTab.innerText;
                
                navigator.clipboard.writeText(text).then(() => {
                    showToast('Analysis copied to clipboard!', 'success');
                }).catch(err => {
                    console.error('Failed to copy:', err);
                    showToast('Failed to copy analysis', 'error');
                });
            });

            // Export analysis as PDF (simulated)
            document.getElementById('exportAnalysisBtn').addEventListener('click', function() {
                showToast('Export feature would generate a PDF report', 'info');
                // In a real implementation, this would generate and download a PDF
            });

            // Apply recommendations (simulated)
            document.getElementById('applyRecommendationsBtn').addEventListener('click', function() {
                showToast('Recommendations would be applied to security systems', 'info');
                // In a real implementation, this would trigger automation workflows
            });

            // Form submission
            iocForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                if (validateForm()) {
                    // Show submission status and disable submit button
                    submissionStatus.style.display = 'block';
                    submissionStatus.scrollIntoView({ behavior: 'smooth' });
                    submitBtn.disabled = true;
                    submitText.textContent = 'Submitting...';
                    submitSpinner.style.display = 'inline-block';
                    
                    // Update status steps
                    document.getElementById('step1').classList.add('completed');
                    document.getElementById('step2').classList.add('active');
                    
                    try {
                        // Prepare submission data
                        const formData = {
                            type: iocType.value,
                            value: iocValue.value.trim(),
                            threatLevel: threatLevel.value,
                            confidence: parseInt(confidence.value),
                            description: document.getElementById('description').value.trim(),
                            tags: document.getElementById('tags').value.split(',').map(tag => tag.trim()).filter(tag => tag),
                            firstSeen: document.getElementById('firstSeen').value || null,
                            lastSeen: document.getElementById('lastSeen').value || null,
                            isAnonymous: document.getElementById('anonymize').checked
                        };

                        // Submit to backend
                        const response = await fetch(`${API_BASE_URL}/ioc/submit`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(formData)
                        });

                        const result = await response.json();

                        if (response.ok) {
                            // Update status steps
                            document.getElementById('step2').classList.remove('active');
                            document.getElementById('step2').classList.add('completed');
                            document.getElementById('step3').classList.add('active');
                            
                            // Simulate blockchain processing
                            setTimeout(() => {
                                document.getElementById('step3').classList.remove('active');
                                document.getElementById('step3').classList.add('completed');
                                document.getElementById('step4').classList.add('active');
                                
                                // Final completion
                                setTimeout(() => {
                                    document.getElementById('step4').classList.remove('active');
                                    document.getElementById('step4').classList.add('completed');
                                    
                                    // Show success message
                                    showToast(
                                        `IOC successfully submitted to the blockchain! Transaction ID: ${result.ioc.blockchainTxHash}`,
                                        'success',
                                        8000
                                    );
                                    
                                    // Reset form and update recent submissions
                                    iocForm.reset();
                                    updateBlockchainPreview();
                                    updateRecentSubmissions();
                                    
                                    // Hide AI analysis section
                                    aiAnalysis.style.display = 'none';
                                    
                                    // Hide status and re-enable button
                                    setTimeout(() => {
                                        submissionStatus.style.display = 'none';
                                        submitBtn.disabled = false;
                                        submitText.textContent = 'Submit to Blockchain';
                                        submitSpinner.style.display = 'none';
                                        
                                        // Reset status steps for next submission
                                        document.getElementById('step1').classList.remove('completed');
                                        document.getElementById('step2').classList.remove('completed');
                                        document.getElementById('step3').classList.remove('completed');
                                        document.getElementById('step4').classList.remove('completed');
                                        document.getElementById('step2').classList.remove('active');
                                        document.getElementById('step3').classList.remove('active');
                                        document.getElementById('step4').classList.remove('active');
                                    }, 2000);
                                }, 1500);
                            }, 2000);
                        } else {
                            throw new Error(result.error || 'Submission failed');
                        }
                    } catch (error) {
                        console.error('Submission error:', error);
                        showToast(`Submission failed: ${error.message}`, 'error');
                        
                        // Reset button state
                        submitBtn.disabled = false;
                        submitText.textContent = 'Submit to Blockchain';
                        submitSpinner.style.display = 'none';
                        
                        // Hide status
                        submissionStatus.style.display = 'none';
                        
                        // Reset status steps
                        document.getElementById('step1').classList.remove('completed');
                        document.getElementById('step2').classList.remove('active');
                    }
                }
            });

            // Get AI Analysis button
            getAnalysisBtn.addEventListener('click', getAIAnalysis);

            // Reset form
            document.getElementById('resetBtn').addEventListener('click', function() {
                if (confirm('Are you sure you want to reset the form? All entered data will be lost.')) {
                    iocForm.reset();
                    updateBlockchainPreview();
                    aiAnalysis.style.display = 'none';
                    
                    // Clear errors
                    document.querySelectorAll('.form-error').forEach(error => {
                        error.style.display = 'none';
                    });
                    document.querySelectorAll('.form-control').forEach(input => {
                        input.classList.remove('error');
                    });
                }
            });

            // Save draft
            document.getElementById('saveDraftBtn').addEventListener('click', function() {
                const formData = {
                    type: iocType.value,
                    value: iocValue.value,
                    threatLevel: threatLevel.value,
                    confidence: confidence.value,
                    description: document.getElementById('description').value,
                    tags: document.getElementById('tags').value,
                    firstSeen: document.getElementById('firstSeen').value,
                    lastSeen: document.getElementById('lastSeen').value,
                    isAnonymous: document.getElementById('anonymize').checked
                };
                
                localStorage.setItem('iocDraft', JSON.stringify(formData));
                showToast('Draft saved successfully!', 'info');
            });

            // Load draft if exists
            function loadDraft() {
                const draft = localStorage.getItem('iocDraft');
                if (draft) {
                    if (confirm('A saved draft was found. Would you like to load it?')) {
                        const formData = JSON.parse(draft);
                        
                        iocType.value = formData.type;
                        threatLevel.value = formData.threatLevel;
                        iocValue.value = formData.value;
                        confidence.value = formData.confidence;
                        document.getElementById('description').value = formData.description;
                        document.getElementById('tags').value = formData.tags;
                        document.getElementById('firstSeen').value = formData.firstSeen;
                        document.getElementById('lastSeen').value = formData.lastSeen;
                        document.getElementById('anonymize').checked = formData.isAnonymous;
                        
                        confidenceValue.textContent = formData.confidence + '%';
                        updateBlockchainPreview();
                        
                        showToast('Draft loaded successfully!', 'info');
                    }
                }
            }

            // Template handlers
            document.querySelectorAll('[data-template]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const template = this.getAttribute('data-template');
                    
                    // Set the IOC type
                    iocType.value = template;
                    
                    // Set example values based on template
                    const examples = {
                        'ip': '192.168.1.100',
                        'domain': 'malicious-example.com',
                        'url': 'https://malicious-site.com/path/to/exploit',
                        'hash-md5': '5d41402abc4b2a76b9719d911017c592'
                    };
                    
                    if (examples[template]) {
                        iocValue.value = examples[template];
                        iocValue.placeholder = `Enter ${template} value (e.g., ${examples[template]})`;
                    }
                    
                    updateBlockchainPreview();
                    showToast(`Loaded ${template} template`, 'info');
                });
            });

            // Update recent submissions from API
            async function updateRecentSubmissions() {
                try {
                    const response = await fetch(`${API_BASE_URL}/ioc?limit=4`);
                    const data = await response.json();
                    
                    if (response.ok) {
                        const recentList = document.getElementById('recentSubmissionsList');
                        recentList.innerHTML = '';
                        
                        if (data.iocs && data.iocs.length > 0) {
                            data.iocs.forEach(ioc => {
                                const item = document.createElement('li');
                                item.className = 'recent-item';
                                
                                const typeMap = {
                                    'ip': 'IP', 'domain': 'DOM', 'url': 'URL', 
                                    'hash-md5': 'HASH', 'hash-sha1': 'HASH', 'hash-sha256': 'HASH',
                                    'email': 'EML', 'cidr': 'CIDR', 'asn': 'ASN'
                                };
                                
                                const timeAgo = getTimeAgo(new Date(ioc.createdAt));
                                
                                item.innerHTML = `
                                    <div class="recent-type">${typeMap[ioc.type] || 'IOC'}</div>
                                    <div class="recent-value">${ioc.value}</div>
                                    <div class="recent-time">${timeAgo}</div>
                                `;
                                
                                recentList.appendChild(item);
                            });
                        } else {
                            recentList.innerHTML = '<li class="recent-item"><div class="recent-value" style="text-align: center; color: var(--gray);">No recent submissions</div></li>';
                        }
                    }
                } catch (error) {
                    console.error('Error fetching recent submissions:', error);
                }
            }

            // Helper function to format time ago
            function getTimeAgo(date) {
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);

                if (diffMins < 1) return 'just now';
                if (diffMins < 60) return `${diffMins}m ago`;
                if (diffHours < 24) return `${diffHours}h ago`;
                if (diffDays < 7) return `${diffDays}d ago`;
                return date.toLocaleDateString();
            }

            // View submission history
            document.getElementById('viewHistoryBtn').addEventListener('click', function() {
                showToast('Opening submission history...', 'info');
                setTimeout(() => {
                    alert('Submission history feature would open here. This would show all your previous IOC submissions with their status and details.');
                }, 500);
            });

            // Initialize blockchain preview and load recent submissions
            document.addEventListener('DOMContentLoaded', function() {
                updateBlockchainPreview();
                updateRecentSubmissions();
                loadDraft();
            });
        </script>
</body>
</html>